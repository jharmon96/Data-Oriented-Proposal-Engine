This document explains how to upload and prepare the data tables in PostgreSQL

Individual annual data tables should have been ingested using the intstuctions in the 'ingestion' folder

Consolidate all of the annual data tables using the following sql code:
CREATE TABLE consolidated_data AS
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2014_1"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2014_2"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2015_1"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2015_2"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2015_3"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2015_4"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2016_1"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2016_2"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2016_3"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2016_4"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2017_1"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2017_2"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2017_3"
	UNION ALL
	SELECT Contract_transaction_unique_key, modification_number, federal_action_obligation, total_dollars_obligated, base_and_exercised_options_value, base_and_all_options_value, action_date, action_date_fiscal_year , awarding_agency_code, awarding_sub_agency_code, awarding_sub_agency_name, awarding_office_code, awarding_office_name, funding_sub_agency_code, funding_sub_agency_name, funding_office_code, funding_office_name, recipient_duns, recipient_name, recipient_country_code, recipient_state_code, primary_place_of_performance_country_code, primary_place_of_performance_state_code, award_or_idv_flag, award_type_code, award_type, type_of_contract_pricing_code, type_of_contract_pricing, product_or_service_code, product_or_service_code_description, dod_claimant_program_code, dod_claimant_program_description, naics_code, naics_description, extent_competed_code, extent_competed, solicitation_procedures_code, solicitation_procedures, type_of_set_aside_code, type_of_set_aside, number_of_offers_received, performance_based_service_acquisition_code, performance_based_service_acquisition, multi_year_contract_code, multi_year_contract,  contracting_officers_determination_of_business_size_code, contracting_officers_determination_of_business_size,  number_of_employees, annual_revenue, contract_bundling_code, contract_bundling, dod_acquisition_program_code, dod_acquisition_program_description, subcontracting_plan_code, subcontracting_plan, evaluated_preference_code, evaluated_preference, national_interest_action_code, national_interest_action, cost_or_pricing_data_code, cost_or_pricing_data, gfe_gfp_code, gfe_gfp, contract_financing_code, contract_financing
	FROM "2017_4";
    
Read in the PSC_taxomy_map and NAICS_buckets CSV files to the PostgreSQL database using Upload_DF_to_Postgres.ipynb from the 'ingestion' folder

Create a filtered data set called consolidate_data2 using the following sql code:
CREATE TABLE consolidated_data2 AS
SELECT consolidated_data.*, psc_taxonomy_map."psc_type", psc_taxonomy_map."portfolio_group", naics_buckets."naics_bucket_title"
FROM consolidated_data
LEFT JOIN psc_taxonomy_map ON psc_taxonomy_map."psc_code" = consolidated_data."product_or_service_code"
LEFT JOIN naics_buckets ON naics_buckets."naics17" = consolidated_data."naics_code"
WHERE modification_number = '0' 
	AND primary_place_of_performance_country_code = 'USA' 
	AND action_date_fiscal_year = '2017'
	AND psc_type = 'Service';

Create a 2017 test data set called data_2017 using the following sql code:
CREATE TABLE data_2017 AS
SELECT consolidated_data.*, psc_taxonomy_map."psc_type", psc_taxonomy_map."portfolio_group", naics_buckets."naics_bucket_title"
FROM consolidated_data
LEFT JOIN psc_taxonomy_map ON psc_taxonomy_map."psc_code" = consolidated_data."product_or_service_code"
LEFT JOIN naics_buckets ON naics_buckets."naics17" = consolidated_data."naics_code"
WHERE modification_number = '0' 
	AND primary_place_of_performance_country_code = 'USA' 
	AND action_date_fiscal_year = '2017'
	AND psc_type = 'Service';
